#! /boot/loader.js:initDevice

// network system

console.debug("hi")

async function fetchURL(url, type, body, headers) {
    let response
    let data
    try {
        const reqOpt = {
            method: String(type).toUpperCase()
        }
        if (body !== undefined) {
            opt.body = window.stringify(body)
        }
        if (typeof headers == "object") {
            opt.headers = headers
        }
        
        response = await fetch(url, reqOpt);
        data = await response.text();
    } catch (e) {
        console.warn(e)
        return undefined
    }

    if (response.ok) {
        return data;
    } else {
        if (response.status == 404) {
            return undefined
        }
        console.warn(response)
        return undefined
    }
}

const ropes = {
    get: async (url, body, headers) => {
        system.debug("/dev/eth0", "fetchURL:get request sent to " + url)

        return fetchURL(url, "GET", body, headers)
    },
    post: async (url, body, headers) => {
        system.debug("/dev/eth0", "fetchURL:post request sent to " + url)

        return fetchURL(url, "POST", body, headers)
    }
}

return {
    ropes: ropes
}